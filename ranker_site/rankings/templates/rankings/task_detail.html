{% extends 'base.html' %}

{% block page_content %}
  <div class="container">
    <h2>Task</h2>

    <div class="task-content">
      {% for word in task.content.split %}
        <button class="word-button" onclick="toggleButtonColor(this)">{{ word }}</button>
      {% endfor %}
    </div>

    <button class="submit-button" onclick="submitOrder()">Submit order</button>
    <input type="hidden" id="user-id" value="{{ user_id }}">
  </div>

  <script>
    var selectedWords = [];

    function toggleButtonColor(button) {
      if (button.classList.contains('selected')) {
        button.classList.remove('selected');
        var index = selectedWords.indexOf(button.textContent);
        if (index !== -1) {
          selectedWords.splice(index, 1);
        }
      } else {
        button.classList.add('selected');
        selectedWords.push(button.textContent);
      }
    }

      function submitOrder() {
        // Get the user ID and task ID from your backend or any appropriate source
        var userId = document.getElementById('user-id').value;
        var taskId = "{{ task.id }}";

        // Prepare the order data to be sent to the server
        var orderData = {
          userId: userId,
          taskId: taskId,
          selectedWords: selectedWords
        };

        // Send the order data to the server
        // You can use AJAX, fetch, or any other method to send the data
        // Here, we'll use fetch as an example
        fetch('/submit-order', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(orderData)
        })
          .then(response => {
            if (response.ok) {
              console.log('Order submitted successfully!');
              // Perform any further actions or display success message
            } else {
              console.error('Failed to submit the order.');
              // Handle the error condition appropriately
            }
            console.log(orderData)
          })
          .catch(error => {
            console.error('An error occurred while submitting the order:', error);
            // Handle the error condition appropriately
          });
      }
  </script>

  <style>
    .selected {
      background-color: yellow;
    }
  </style>
{% endblock %}